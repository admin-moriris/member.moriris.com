<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Moriris Members – Login</title>

<input id="email" type="email" placeholder="you@example.com" style="padding:12px;width:260px">
<button id="login" type="button" style="padding:12px">メール送信</button>
<p id="msg"></p>

<!-- supabase-js v3 を1本だけ読み込む -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@3"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const SUPABASE_URL = "https://sqwyfscumunyhsvsvejv.supabase.co";
  const SUPABASE_PUBLISHABLE_KEY = "sb_publishable_2ZYSSnkqprmzY0_eK5C6DA_nx075Rkb"; // あなたの publishable key

  // クライアント生成
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
    auth: { persistSession: true, autoRefreshToken: true, storageKey: "moriris-auth" }
  });

  const $ = (s)=>document.querySelector(s);
  const btn = $("#login");
  const msg = $("#msg");

  btn.addEventListener("click", async () => {
    const email = $("#email").value.trim();
    msg.textContent = "";                // メッセージ初期化
    console.log("clicked", email);       // クリック確認
    if (!email) { msg.textContent = "メールを入力してください"; return; }

    btn.disabled = true;
    msg.textContent = "送信中…";
    try {
      const { data, error } = await sb.auth.signInWithOtp({
        email,
        options: {
          emailRedirectTo: "https://member.moriris.com/members.html",
          shouldCreateUser: true
        }
      });
      console.log("signInWithOtp result:", { data, error });
      if (error) throw error;
      msg.textContent = "送信しました。メールを確認してください。";
    } catch (e) {
      console.error(e);
      msg.textContent = "Error: " + (e?.message || String(e));
    } finally {
      btn.disabled = false;
    }
  });
});
</script>
</html>
