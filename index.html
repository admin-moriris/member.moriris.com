<!-- headのどこかに -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<script type="module">
  const SUPABASE_URL = "https://sqwyfscumunyhsvsvejv.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNxd3lmc2N1bXVueWhzdnN2ZWp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0ODM4NDQsImV4cCI6MjA3NzA1OTg0NH0.P_6eP5E_Du82IEI1gzn4PKQjnqlVGoptmZZR9aIiXNU";
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: { persistSession: true, autoRefreshToken: true, storageKey: "moriris-auth" }
  });

  document.getElementById("login").onclick = async () => {
    const email = document.getElementById("email").value.trim();
    if (!email) return;

    const { error } = await sb.auth.signInWithOtp({
      email,
      options: {
        shouldCreateUser: true,
        // ← 公開URLと完全一致させる
        emailRedirectTo: "https://member.moriris.com/members.html"
      }
    });
    document.getElementById("msg").textContent = error ? `Error: ${error.message}` : "OK";
  };

  document.getElementById("to-members").onclick = () =>
    location.href = "./members.html";
</script>
