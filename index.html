<!-- 送信UI -->
<input id="email" type="email" placeholder="you@example.com">
<button id="login">メール送信</button>
<p id="msg"></p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@3"></script>
<script>
  const SUPABASE_URL = "https://sqwyfscumunyhsvsvejv.supabase.co";
  const SUPABASE_PUBLISHABLE_KEY = "sb_publishable_2ZYSSnkqprmzY0_eK5C6DA_nx075Rkb"; // 実キー
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
    auth: { persistSession: true, autoRefreshToken: true, storageKey: "moriris-auth" }
  });

  const $ = (s)=>document.querySelector(s);
  $("#login").addEventListener("click", async () => {
    const email = $("#email").value.trim();
    if (!email) { $("#msg").textContent = "メールを入力してください"; return; }

    $("#login").disabled = true;
    $("#msg").textContent = "送信中…";
    try {
      const { data, error } = await sb.auth.signInWithOtp({
        email,
        options: {
          emailRedirectTo: "https://member.moriris.com/members.html",
          shouldCreateUser: true
        }
      });
      console.log("signInWithOtp:", { data, error });
      if (error) throw error;
      $("#msg").textContent = "送信しました。メールを確認してください。";
    } catch (e) {
      console.error(e);
      $("#msg").textContent = "Error: " + (e.message || e);
    } finally {
      $("#login").disabled = false;
    }
  });
</script>
